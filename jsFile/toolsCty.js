innerpath="0_files/innerpath";

genus_arr="All,Citrobacter,Schizosaccharomyces,Exobasidium,Entamoeba,Naegleria,Lentivirus,Trichomonas,Antarctobacter,Diaporthe,Besnoitia,Epicoccum,Ustilago,Acrodontium,Heteroplacidium,Chaetomium,Physarum,Salpingoeca,Purpureocillium,Aspergillus,Acidovorax,Cercospora,Lecidea,Phytophthora,Chilodonella,Bysmatrum,Trichophyton,Montagnula,Erysiphe,Fusarium,Gammaretrovirus,Spathularia,Sargassum,Codosiga,Difflugia,Cutibacterium,Yarrowia,Colpoda,Alphapapillomavirus,Blastocystis,Cyclotella,Malassezia,Fuligo,Aphanoascus,Margalefidinium,Chromera,Exophiala,Orthohepevirus,Bacillus,Pneumocystis,Alternaria,Theileria,Pyropia,Pyricularia,Thermothielavioides,Betacoronavirus,Helicobacter,Burkholderia,Rhodotorula,Simplexvirus,Carlavirus,Quinqueloculina,Aerococcus,Pichia,Anaerococcus,Yersinia,Babesia,Cytomegalovirus,Poterioochromonas,Lecanactis,Streptomyces,Astrosphaeriella,Lymphocryptovirus,Diachea,Meyerozyma,Saccharomyces,Bensingtonia,Trichoderma,Cryptosporidium,Mastadenovirus,Phialophora,Hypsizygus,Ectocarpus,Phaffomyces,Sugiyamaella,Klebsiella,Bipolaris,Usnea,Umbilicaria,Pythium,Drechmeria,Mycoplasma,Hymenelia,Stemonitis,Acanthamoeba,Cyanidioschyzon,Sclerotinia,Roussoellopsis,Streptococcus,Amphora,Octospora,Chitinimonas,Dictyocheirospora,Diderma,Staphylococcus,Aglaothamnion,Gracilaria,Vaucheria,Suillus,Clonostachys,Botrytis,Ampelomyces,Saccharina,Polarella,Emiliania,Capsaspora,Rhynchopus,Chaetosphaerella,Aureobasidium,Meira,Sporothrix,Paravannella,Nakazawaea,Epichloe,Stygiella,Hepatozoon,Brevundimonas,Acinetobacter,Moraxella,Neisseria,Kingella,Eikenella,Aggregatibacter,Haemophilus,Bacteroides,Fusobacterium,Finegoldia,Peptostreptococcus,Schaalia,Peptococcus,Candida,Plasmodium,Porphyromonas,Prevotella,Veillonella,Cladosporium,Peptoniphilus,Wildemania,Granulicatella,Treponema,Otidea,Taphrina,Bisgaardia,Lachnoanaerobaculum,Filifactor,Eimeria,Leptotrichia,Ilyobacter,Lepra,Nicoletella,Hemiselmis,Flamella,Paradinium,Syntrophobotulus,Ustilaginoidea,Scutaria,Richelia,Thermoanaerosceptrum,Campylobacter,Bergeriella,Actinobacillus,Glaesserella,Pasteurella,Parabacteroides,Capnocytophaga,Enterococcus,Alkalihalobacillus,Paraclostridium,Clostridioides,Lactobacillus,Kluyveromyces,Penicillium,Corynebacterium,Peptoanaerobacter,Guillardia,Sphaerozoum,Amanita,Mannheimia,Hamigera,Farysia,Alysiella,Adenoides,Sellaphora,Sticta,Gramella,Porphyra,Desulfotomaculum,Paraprevotella,Placidium,Verrucaria,Anomoloma,Pontoporeia,Desulfallas,Aureibacter,Morococcus,Tetragenococcus,Bibersteinia,Talaromyces,Lacrimispora,Vestergrenopsis,Flavobacterium,Marinicauda,Cordierites,Micrococcus,Kocuria,Paeniclostridium,Nakaseomyces,Orthohepadnavirus,Abiotrophia,Pyrsonympha,Mastigamoeba,Lirula,Terrahaemophilus,Pertusaria,Astraeus,Encyonema,Paramonosiga,Simonsiella,Chryseobacterium,Escherichia,Cardiobacterium,Millerozyma,Scheffersomyces,Wickerhamomyces,Saccharomycopsis,Debaryomyces,Cryptococcus,Metschnikowia,Eremothecium,Teunomyces,Rothia,Aureococcus,Hyphopichia,Lautropia,Barnettozyma,Basfia,Helicobasidium,Yamadazyma,Paenibacillus,Alicyclobacillus,Rhodocybella,Sporisorium,Basilea,Dyella,Goniomonas,Massilia,Pseudomonas,Psychrobacter,Nitrosospira,Pseudopedobacter,Cymbella,Byssochlamys,Monascus,Pseudoplectania,Ascothailandia,Paracoccus,Tricholoma,Leucoscypha,Thioclava,Methylorubrum,Catathelasma,Leucodecton,Isochrysis,Caloscypha,Bunodophoron,Erratomyces,Anoxybacillus,Physarella,Wardomyces,Salispina,Novispirillum,Methylobacterium,Aeromonas,Lysinibacillus,Schizophyllum,Trichosporon,Leishmania,Toxoplasma,Thermomonas,Neobacillus,Cloacibacterium,Ochrobactrum,Enterobacter,Sphingobacterium,Mycobacterium,Skeletonema,Leucosporidium,Euplotes,Flavivirus,Hanseniaspora,Achromobacter,Phaeocystis,Clavispora,Glaucocystis,Graphiola,Pyxidiophora,Devosia,Angomonas,Leucoagaricus,Haplospora,Sporosarcina,Comamonas,Cutaneotrichosporon,Craterium,Chlorociboria,Deinococcus,Brebissonia,Tremella,Neocampanella,Capronia,Jattaea,Neurospora,Aphanomyces,Morosphaeria,Botuliforma,Chroomonas,Stenamoeba,Dioszegia,Padina,Alcaligenes,Atlantibacter,Bacteriovorax,Clostridium,Cryptomonas,Vanrija,Novosphingobium,Phascolarctobacterium,Lodderomyces,Dietzia,Heteromita,Kluyvera,Ampulloclitocybe,Bullera,Phyllactinia,Desemzia,Rasamsonia,Peptacetobacter,Imshaugia,Pterothamnion,Caulobacter,Apiotrichum,Polaromonas,Delftia,Stenotrophomonas,Lotharella,Leucobacter,Mattirolomyces,Romboutsia,Aureimonas,Verticillium,Castellaniella,Velundella,Bhatiellae,Planococcus,Cyberlindnera,Kodamaea,Ochromonas,Empedobacter,Rhodobacter,Mycolicibacterium,Filobasidium,Lycoperdon,Trypanosoma,Telluria,Glutamicibacter,Afipia,Tryblidiopsis,Hygrocybe,Hungatella,Haematobacter,Peribacillus,Peltigera,Carboxydothermus,Parabodo,Shinella,Thioalkalivibrio,Cronobacter,Pinnularia,Gordonia,Cytobacillus,Collimonas,Eucyrtidium,Mayamaea,Hydrosilicon,Monacrosporium,Lysobacter,Parastagonospora,Plasmodiophora,Apinisia,Phacopsis,Brevibacillus,Leclercia,Sphingomonas,Sporopachydermia,Protomyces,Monosiga,Kytococcus,Fistulifera,Herbaspirillum,Tranzscheliella,Kurthia,Athelia,Lecidella,Giardia,Alphavirus,Nostoc,Anabaena,Placynthium,Chroogloeocystis,Brasilonema,Modestobacter,Catenulispora,Lachnellula,Navicula,Pleurasiga,Protolitonotus,Aliterella,Ostreopsis,Leuconostoc,Acetobacter,Anthracocystis,Brettanomyces,Blastomonas,Symbiotaphrina,Fistulina,Dipodascus,Sphingobium,Ramalina,Gonostomum,Hymenobacter,Blastomyces,Fonticula,Fimbriimonas,Leptographium,Avibacterium,Cylindrotheca,Chlorarachnion,Pterocladia,Thioploca,Subbaromyces,Ascovaginospora,Gymnochlora,Micropruina,Platismatia,Dibaeis,Rhodochaete,Galdieria,Sarcocystis,Serratia,Gracilariopsis,Cladonia,Septoria,Polerovirus,Cytophaga,Paraconiothyrium,Voromonas,Anteholosticha,Nocardioides,Durotheca,Pyrenula,Teloschistes,Thecamonas,Laccaria,Plagioselmis,Thermanaeromonas,Kazachstania,Phialemonium,Rhizomastix,Endocarpon,Phaeoacremonium,Defluviimonas,Ceraceosorus,Lentzea,Orrella,Agaricus,Erythrocolon,Halomonas,Coleosporium,Tribonema,Nannochloropsis,Nuclearia,Inocybe,Nitzschia,Hirschia,Baudoinia,Metarhizium,Protoperidinium,Philaster,Betapolyomavirus,Claussenomyces,Pleurotus,Dictyostelium,Prymnesium,Archangium,Cavenderia,Geosmithia,Oryzomicrobium,Serratifera,Acidipropionibacterium,Passalora,Heterostelium,Haplosporidium,Curdiea,Paraphysomonas,Glaucosphaera,Tuber,Cephaloascus,Boudiera,Lachnum,Grosmannia,Distigma,Delitschia,Xanthoparmelia,Paraburkholderia,Peziza,Beauveria,Ebolavirus,Carpediemonas,Monomorphina,Aulacoseira,Speerschneidera,Polykrikos,Bicosoeca,Elsinoe,Eucomonympha,Chaetoceros,Gambierdiscus,Spumochlamys,Badhamia,Astrochapsa,Diorchidium,Chelonemonas,Dermabacter,Iotanema,Geastrum,Selenidium,Saccharopolyspora,Pseudonocardia,Lentinula,Respirovirus,Naumovozyma,Fragilidium,Cordyceps,Lobospira,Bellemerea,Notosolenus,Fasciatispora,Eunotia,Melampsora,Erythrobacter,Pullenia,Sappinia,Entoloma,Scedosporium,Aspidisca,Gregarina,Plagiostoma,Francisella,Pleurotheciella,Bullinularia,Reticulamoeba,Stictocyclus,Labilithrix,Acytostelium,Paraphaeosphaeria,Paracamarosporium,Fusichalara,Montagnia,Ascotaiwania,Dicrateria,Betaretrovirus,Gromia,Volvariella,Paurocotylis,Clavariadelphus,Acarospora,Symbiomonas,Chaenotheca,Pseudoamphisiella,Pseudocercospora,Zasmidium,Hydeomyces,Zygoascus,Ophiostoma,Blattabacterium,Acaromyces,Olpidiopsis,Bradyrhizobium,Brachyspira,Cladophialophora,Edwardsiella,Immersiporthe,Sulfuracidifex,Ralstonia,Acidiphilium,Rhodymenia,Kwoniella,Sphaerobolus,Amphidinium,Saccamoeba,Tetramitus,Leptogium,Lophocladia,Plasmopara,Borreliella,Phaeophyscia,Osmundaria,Centropyxis,Trematosphaeria,Histoplasma,Morchella,Ascoidea,Melanopsichium,Lentomitella,Cyanidium,Ascosphaera,Alpharetrovirus,Riemerella,Epidermophyton,Orbivirus,Warcupiella,Vacuolaria,Globigerinella,Monilinia,Cryptobia,Moesziomyces,Trapelia,Holomastigotoides,Physconia,Danielozyma,Astasia,Myriangium,Caliciopsis,Bigelowiella,Macroventuria,Daldinia,Aurigamonas,Strombidium,Periconia,Parmeliella,Urocystis,Articulospora,Paecilomyces,Gaeumannomyces,Protostelium,Normandina,Maullinia,Ogataea,Conoideocrella,Paraglaciecola,Kalmanozyma,Pochonia,Chondria,Myriospora,Paramoebidium,Allodekkera,Mycena,Favella,Dothidotthia,Costaria,Leptoxyphium,Calicium,Epistylis,Trichodinella,Lampriscus,Rhodopseudomonas,Surirella,Pygsuia,Pectenia,Microchloropsis,Rhaphoneis,Evernia,Carinispora,Dinema,Flammeascoma,Paraphelidium,Rhinocladiella,Amoeba,Parvimonas,Apophlaea,Rhizopogon,Korotnevella,Hypholoma,Entodinium,Bifidobacterium,Lachnospira,Biatora,Symbiodinium,Prorocentrum,Chromocleista,Vannella,Neospora,Ammonia,Rhizorhabdus,Paulinella,Squamarina,Halteria,Heterococcus,Capnodium,Rutstroemia,Blautia,Dialister,Filimonas,Fluviicola,Sphaerospermopsis,Stylonema,Cohnilembus,Selenomonas,Bangia,Togula,Magnusiomyces,Enterocloster,Pectinatus,Listeria,Propionigenium,Tyzzerella,Sneathia,Schwartzia,Nyctotherus,Serpula,Pseudobutyrivibrio,Catonella,Olsenella,Centipeda,Muribaculum,Microvirga,Peridinium,Tuckermannopsis,Telaepolella,Paramoeba,Blastobotrys,Peronospora,Phaeophleospora,Suillellus,Devriesia,Cercomonas,Scolecolachnum,Wickerhamiella,Diploschistes,Hatena,Acidothermus,Toxicocladosporium,Amoebidium,Kurtzmaniella,Kockovaella,Albotricha,Triplumaria,Gymnosporangium,Balantidium,Phragmotaenium,Marquandomyces,Gonyaulax,Entyloma,Macrotyphula,Discosporangium,Gomphillus,Hypomontagnella,Lawreyella,Loxodes,Protoopalina,Hyalophysa,Orthopneumovirus,Coccocarpia,Geobacillus,Vermamoeba,Microsporum,Arthrobacter,Armillaria,Gymnoascus,Trichocoma,Gymnascella,Xeromyces,Silvetia,Dactylina,Trichia,Orbilia,Phymatotrichopsis,Nakamurella,Macrococcus,Didymella,Hypogymnia,Lecanographa,Dingleya,Nannizziopsis,Leiothecium,Steinera,Solirubrobacter,Xerochrysium,Protounguicularia,Elizabethkingia,Lactococcus,Eremascus,Thermomyces,Bresslaua,Microbacterium,Homalozoon,Renispora,Sarcoscypha,Sagenomella,Pyrenophora,Lecanora,Neophyllis,Shanorella,Mycocalicium,Trimastix,Knufia,Pirsonia,Platygloea,Rhizosolenia,Ophiocordyceps,Conchellium,Hydnomerulius,Teratosphaeria,Staurothele,Lepraria,Lambertella,Placopyrenium,Reddellomyces,Tardiphaga,Massaria,Bryoria,Neocatenulostroma,Emmonsiellopsis,Bacidia,Lophodermium,Goussia,Photobacterium,Saprolegnia,Trigonium,Verminephrobacter,Ochroconis,Grimontia,Gomphus,Picophagus,Loxosporopsis,Metopion,Exserohilum,Oxyrrhis,Monoicomyces,Corynelia";

celltype_full_name_use="";
$.ajaxSettings.async = false;
$.getJSON(innerpath+"/celltype_full_name_use.txt", "", function(data_re) {
	celltype_full_name_use=data_re;
});



celltype_xml('celltype_xml',celltype_full_name_use);
genus_arr_xml("xml_bac_detail",genus_arr);
toolsDetailShow('GSE179572_GSM5420750',"T-Lym","All");

function celltype_xml(div,celltype_full_name_use){
	////
	//var data_option=[];
	var data_option = Object.keys(celltype_full_name_use);
	////
	var data_option_valuearray = [];
	for (var i=0;i<data_option.length;i++)
					{ 
						json={}
						json['name']=celltype_full_name_use[data_option[i]];
						json['value']=data_option[i];
						data_option_valuearray.push(json);
					}
	var e="#"+div;
					var demo1_gene = xmSelect.render({
						el: e, 
						filterable: true,
						size: 'big',//选中的之后显示的字的大小
					    theme: {color: '#ff9a18',},//主题颜色
						tips: 'Select a key for view',
						style: {
		marginLeft: '0px',
		borderRadius: '1px',
		height: '48px',
		//width:'400px',
		border: '1px solid #ced4da',
	},
						radio: true,
						clickClose: true,
						filterable: true,
						data: [],
						on: function(data){//监听
							var arr = data.arr;
							var change = data.change;
							//isAdd, 此次操作是新增还是删除
							var isAdd = data.isAdd;
							var gene0=arr[0]["value"];
							///
							//gene_spatial_exp(gene0,div_color);
							
							}
					})
					demo1_gene.update({
					data: data_option_valuearray
					})
	// 赋值
			demo1_gene.setValue([
			{name: celltype_full_name_use[data_option[0]], value: data_option[0]},
			])
}




function genus_arr_xml(div,genus_arr){
	var data_option=genus_arr.split(",");
	var data_option_valuearray = [];
	for (var i=0;i<data_option.length;i++)
					{ 
						json={}
						json['name']=data_option[i];
						json['value']=data_option[i];
						data_option_valuearray.push(json);
					}
	var e="#"+div;
					var demo1_gene = xmSelect.render({
						el: e, 
						filterable: true,
						size: 'big',//选中的之后显示的字的大小
					    theme: {color: '#ff9a18',},//主题颜色
						tips: 'Select a key for view',
						style: {
		marginLeft: '0px',
		borderRadius: '1px',
		height: '48px',
		//width:'400px',
		border: '1px solid #ced4da',
	},
						radio: true,
						clickClose: true,
						filterable: true,
						data: [],
						on: function(data){//监听
							var arr = data.arr;
							var change = data.change;
							//isAdd, 此次操作是新增还是删除
							var isAdd = data.isAdd;
							var gene0=arr[0]["value"];
							///
							//gene_spatial_exp(gene0,div_color);
							
							}
					})
					demo1_gene.update({
					data: data_option_valuearray
					})
	// 赋值
			demo1_gene.setValue([
			{name: data_option[0], value: data_option[0]},
			])
}


function toolsCty(){
	$("#loading1").show();
	var celltype = xmSelect.get('#celltype_xml', true).getValue('valueStr');
	var bac= xmSelect.get('#xml_bac_detail', true).getValue('valueStr');
	
	var xmlHttp=new XMLHttpRequest();
	xmlHttp.onreadystatechange =function(){
		//处理返回的数据，更新当前页面
		if(xmlHttp.readyState == 4 && xmlHttp.status == 200){
			var returnData=xmlHttp.responseText;
		//alert(returnData);
			//eval 执行括号中的代码或者JSON.parse，把json格式转化为json对象
			var jsonobj=JSON.parse(returnData);
			if(jsonobj.error_attention=="no"){
				////
				
				document.getElementById("ToolsSearchTable").style.display="block";
				//var oldTable = $('#tools_sub_table').dataTable();
				//oldTable.fnClearTable(); //清空一下table
				//oldTable.fnDestroy(); //还原初始化了的dataTable
				
				if ($.fn.dataTable.isDataTable('#tools_sub_table')) {
					$('#tools_sub_table').DataTable().clear().destroy();
				}
				ToolsSubTable_cty("0_files/ToolsBacCty.txt",celltype,bac);
			}else{
				////
				document.getElementById("ToolsSearchTable").style.display="block";
				document.getElementById("ToolsSearchTable").innerHTML="No result";
			}
			$("#loading1").hide();
				}
			}
	var param="celltype="+celltype+"&bac="+bac+"&toolsType=bacCty";
	
	xmlHttp.open("get","MysqlTools.jsp?"+param,true);
	xmlHttp.send();
}



function ToolsSubTable_cty(path,celltype,bac){
	var path=path;
	$(document).ready(function() {
		$("#tools_sub_table").DataTable( {
		"bLengthChange": false, //开关，是否显示每页显示多少条数据的下拉框
        "aLengthMenu": [5,10,20],//设置每页显示数据条数的下拉选项
        'iDisplayLength': 5, //每页初始显示5条记录
		"deferRender": true,
		"bProcessing": true, 
		"searching" : false,
		"paginationType": "full_numbers",
		"serverSide": false, 
		"order": [[ 0, 'desc' ]],
		'ajax': path,
		'columns':[
		{'data':'cancer'},
		{'data':null,"render": function ( data, type, row, meta ) { return celltype;}},
		{'data':null,"render": function ( data, type, row, meta ) { return bac;}},
		{'data':'spot_num'},
		{'data':'marker_gene_num'},
		//{'data':'marker_gene_num'},
		//{'data':'cell_num'},
		{'data':'celltype_num'},
		{'data':null,
    		"render": function ( data, type, row, meta ) {  
			var publication=row['publication'];
			if(publication.length > 5){
				publication="<span title='" + publication + "'>" + publication.substr(0, 4) + '&#8230;</span>';
			}
    		return  "<a   target='_blank' href='"+row['paper_http']+"'> <i class='fa-solid fa-link' style='font-size:16px;color:#ff9a18' aria-hidden='true'   ></i> "+publication+"</a> ";
    		}
    		},
		{'data':null,
		"render": function ( data, type, row, meta ) {  
		//console.log("<button class='btn btn-danger botton-submit' onclick="+'"'+"toolsDetailShow('"+row['dataset_id']+"')"+'"'+">" +"<i class='fa fa-share' aria-hidden='true' style='font-size:15px;'></i></button>");
		return "<button class='btn btn-danger botton-submit' style='height:35px;' onclick="+'"'+"toolsDetailShow('"+row['dataset_id']+"','"+celltype+"','"+bac+"'"+")"+'"'+">" +"<i class='fa fa-share' aria-hidden='true' style='font-size:15px;'></i></button>";  
						                    }
		}
		]
		} );  
		} );
}



function toolsDetailShow(datasetID,celltype,bac_select){
	$("#loading1").show();
	dataSetID=datasetID
webpath="0_files/slice/"+dataSetID;
bac_table_dir=webpath+"/bac_table";
bac_json=webpath+"/json";

slice_cluster_re="";
$.ajaxSettings.async = false;
$.getJSON(webpath+"/slice_cluster.txt", "", function(data_re) {
	slice_cluster_re=data_re;
});
spot_dev_re=slice_cluster_re;
bac_re="";
$.ajaxSettings.async = false;
$.getJSON(webpath+"/bac_infor.txt", "", function(data_re) {
	bac_re=data_re;
});
bac_celltype_re="";
$.ajaxSettings.async = false;
$.getJSON(webpath+"/part6_bac_hi_celltype_infor.txt", "", function(data_re) {
	bac_celltype_re=data_re;
});

part6_bac_celltype(bac_celltype_re,bac_re,webpath,bac_table_dir,bac_json,celltype,bac_select);
document.getElementById("enrich_b_h").innerHTML="Cell types within high microbiota abundance region of "+dataSetID;

$("#loading1").hide();
}


function part6_bac_celltype(bac_celltype_re,bac_re,webpath,bac_table_dir,bac_json,celltype,bac_select){
	if(bac_select=="All"){
	bac_color_map_celltype(bac_re,"genus");
	}else{
		bac_celltype_colorPlot(bac_re,'genus',bac_select,'bac_celltype_color');
	}
	if ($.fn.dataTable.isDataTable('#bac_celltype_table')) {
		$('#bac_celltype_table').DataTable().clear().destroy();
	}
	
	bac_cell_xml(bac_re,bac_celltype_re,'xml_bac_celltype','bac_celltype_radar','bac_celltype_table','bac_celltype_color',webpath,bac_table_dir,bac_json,celltype,bac_select);
}



function bac_color_map_celltype(bac_re,metagenome_type){
	var metagenome_type0_cluster=bac_re[metagenome_type+"_subclass"].split(",");
	metagenome_type0_cluster.sort();  
	var num_cluster=metagenome_type0_cluster.length;
	data_umap_bac=[];
	
	var json0={};
	json0["name"]="None_Bacteria";
	json0["x"]=bac_re['noneBac_x_umap'].split(",");
	json0["y"]=bac_re['noneBac_y_umap'].split(",");
	json0["text"]=bac_re['noneBac_text_umap'].split(",");
	json0["mode"]='markers';
	json_marker={};
	json_marker["color"]=bac_re['noneBac_color_umap'];
	json_marker["size"]=5;//点大小
	json0["marker"]=json_marker;
	data_umap_bac.push(json0);
	for (var i=0;i<num_cluster;i++){
		var json0={};
		json0["name"]=metagenome_type0_cluster[i];
		var x=metagenome_type+"_"+metagenome_type0_cluster[i]+"_x_umap";
		var y=metagenome_type+"_"+metagenome_type0_cluster[i]+"_y_umap";
		var text0=metagenome_type+"_"+metagenome_type0_cluster[i]+"_text_umap";
		var x_array=bac_re[x].split(",");
		var y_array=bac_re[y].split(",");
		var text0_array=bac_re[text0].split(",");
		json0["x"]=x_array;
		json0["y"]=y_array;
		json0["text"]=text0_array;
		json0["mode"]='markers';
		var color0=metagenome_type+"_"+metagenome_type0_cluster[i]+"_color_umap";
		json_marker={};
		json_marker["color"]=bac_re[color0];
		json_marker["size"]=5;//点大小
		json0["marker"]=json_marker;
		data_umap_bac.push(json0);

	}
	
	//plot
	//bac_umap_width_height(data_umap_bac,'base_bac',metagenome_type,1000,700);
	bac_umap_noleg1_height(data_umap_bac,'bac_celltype_color',metagenome_type,650);
}

function bac_cell_xml(bac_re,bac_celltype_re,div_xml,div_radar,table_div,color_plot_div,webpath,bac_table_dir,bac_json,celltype,bac_select){
	var colnames0=bac_celltype_re["genus_celltype_names"].split(",");
	var data_option=bac_re["genus_subclass"].split(",");
	data_option.unshift('all');
	var data_option_valuearray = [];
	for (var i=0;i<data_option.length;i++)
					{ 
						json={}
						json['name']=data_option[i];
						json['value']=data_option[i];
						data_option_valuearray.push(json);
					}
					var e="#"+div_xml;
					var demo1_gene = xmSelect.render({
						el: e, 
						filterable: true,
						size: 'big',//选中的之后显示的字的大小
					    theme: {color: '#ff9a18',},//主题颜色
						tips: 'Select a key for view',
						radio: true,
						clickClose: true,
						data: [],
						on: function(data){//监听
							var arr = data.arr;
							var change = data.change;
							//isAdd, 此次操作是新增还是删除
							var isAdd = data.isAdd;
							var metagenome_type0=arr[0]["value"];
							///
							if(metagenome_type0=="all"){
							bac_color_map_celltype(bac_re,'genus');}else{
							bac_celltype_colorPlot(bac_re,'genus',metagenome_type0,color_plot_div);}
							//radar_plot_bac_celltype
							data0=[];
							data0_json={};
							data0_json["type"]='scatterpolar';
							data0_json["fill"]='toself';
							r0=bac_celltype_re["genus_"+metagenome_type0+"_celltype_dev"].split(",");
							data0_json["r"]=r0;
							data0_json["theta"]=colnames0;
							data0.push(data0_json);
							r0_max= Math.max(...r0);
							r0_max=Number(r0_max.toFixed(1));
							radar_plot_bac_celltype(data0,div_radar,r0_max);
							//
							//var oldTable = $('#'+table_div).dataTable();
							//oldTable.fnClearTable(); //清空一下table
							//oldTable.fnDestroy(); //还原初始化了的dataTable
							if ($.fn.dataTable.isDataTable('#'+table_div)) {
							$('#'+table_div).DataTable().clear().destroy();
							}
							var path0=bac_table_dir+"/bac_hi_celtype_genus_"+metagenome_type0+".txt";
							
							colnames0= colnames0.filter(item => item !== celltype);
							colnames0.unshift(celltype);
							autoColTable_bac_celltype(path0,colnames0,table_div);
							}
					})
					demo1_gene.update({
					data: data_option_valuearray
					})
		// 赋值
		if((bac_select=="all") ||(bac_select=="All")){
			name0="All";
			name1="all";
			//radar_plot_bac_celltype
			data0=[];
			data0_json={};
			data0_json["type"]='scatterpolar';
			data0_json["fill"]='toself';
			r0=bac_celltype_re["genus_all_celltype_dev"].split(",");
			data0_json["r"]=r0;
			data0_json["theta"]=colnames0;
			data0.push(data0_json);
			r0_max= Math.max(...r0);
			r0_max=Number(r0_max.toFixed(3));
			radar_plot_bac_celltype(data0,div_radar,r0_max);
			//
			var path0=bac_table_dir+"/bac_hi_celtype_genus_all.txt";
			
			colnames0= colnames0.filter(item => item !== celltype);
			colnames0.unshift(celltype);
			autoColTable_bac_celltype(path0,colnames0,table_div);
						
		}else{
			name0=bac_select;
			name1=bac_select;
			metagenome_type0=bac_select;
			//radar_plot_bac_celltype
							data0=[];
							data0_json={};
							data0_json["type"]='scatterpolar';
							data0_json["fill"]='toself';
							r0=bac_celltype_re["genus_"+metagenome_type0+"_celltype_dev"].split(",");
							data0_json["r"]=r0;
							data0_json["theta"]=colnames0;
							data0.push(data0_json);
							r0_max= Math.max(...r0);
							r0_max=Number(r0_max.toFixed(3));
							radar_plot_bac_celltype(data0,div_radar,r0_max);
							//
							//var oldTable = $('#'+table_div).dataTable();
							//oldTable.fnClearTable(); //清空一下table
							//oldTable.fnDestroy(); //还原初始化了的dataTable
							if ($.fn.dataTable.isDataTable('#'+table_div)) {
							$('#'+table_div).DataTable().clear().destroy();
							}
							var path0=bac_table_dir+"/bac_hi_celtype_genus_"+metagenome_type0+".txt";
							
							colnames0= colnames0.filter(item => item !== celltype);
							colnames0.unshift(celltype);
							autoColTable_bac_celltype(path0,colnames0,table_div);
		}
			demo1_gene.setValue([
			{name: name0, value: name1},
			])
			//
			
			

}
function bac_celltype_colorPlot(bac_re,metagenome_type,metagenome_subtype,color_plot_div){
	var xmlHttp=new XMLHttpRequest();
	xmlHttp.onreadystatechange =function(){
		if(xmlHttp.readyState == 4 && xmlHttp.status == 200){
			var returnData=xmlHttp.responseText;
			var jsonobj=JSON.parse(returnData);
			if(jsonobj.error_attention=="no"){
				////
				var color=jsonobj.exp.split(",");
				var slice_spot_name=slice_cluster_re["dev_spots"].split(",");
				var slice_spot_x=slice_cluster_re["spots_x"].split(",");
				var slice_spot_y=slice_cluster_re["spots_y"].split(",");
				plotly_svgSpotScatter_celltype(0.55,metagenome_subtype,slice_spot_name,slice_spot_x,slice_spot_y,color,color_plot_div);

			}else{
				$("#"+color_plot_div).hide();
			}
				}
			}
	var param="metagenome_type="+metagenome_type+"&metagenome_subtype="+metagenome_subtype+"&dataSetID="+dataSetID;
	xmlHttp.open("get","MysqlExp.jsp?"+param,true);
	xmlHttp.send();

}
function plotly_svgSpotScatter_celltype(width0,svg0,name,x,y,color,div){
	var width0=$("#width_id").width()*width0;
	var trace1 = {
	  x: x,
	  y: y,
	  mode: 'markers',
	  opacity:1.2,//透明度
	  text:name,
	  marker: {
		size: 6,
		color: color
	  }
	};
	var data = [trace1];
	var layout = {
	height:600,
	width: width0,
	font :{		    size :16,					},
	title: svg0,
	xaxis:{
		showticklabels : false
	},
	yaxis:{
		showticklabels : false
	}
	};
	Plotly.newPlot(div, data, layout);

	}
function plotly_svgSpotScatter(width0,svg0,name,x,y,color,div){
	var width0=$("#width_id").width()*width0;
	var trace1 = {
	  x: x,
	  y: y,
	  mode: 'markers',
	  opacity:1.2,//透明度
	  text:name,
	  marker: {
		size: 6,
		color: color
	  }
	};
	var data = [trace1];
	var layout = {
	height:600,
	width: width0,
	font :{		    size :16,					},
	title: 'Expression of '+svg0,
	xaxis:{
		showticklabels : false
	},
	yaxis:{
		showticklabels : false
	}
	};
	Plotly.newPlot(div, data, layout);

	}
function radar_plot_bac_celltype(data,div,r0_max){
	data = data

layout = {
	height: 550,
  polar: {
    radialaxis: {
      visible: true,
      range: [0, r0_max]
    }
  },
  showlegend: false
}

Plotly.newPlot(div, data, layout)

}

function autoColTable_bac_celltype(path,colnames,div){
	//colnames：会写到页面上，colname和匹配文件中的key。
	var table_inner="<thead ><tr class='table_head1'><th>Spot</th>";
	var columns=[];
	json={};
	json['data']='_row';
	columns.push(json);
	for (var i=0;i<colnames.length;i++){
		table_inner=table_inner+"<th>"+colnames[i]+"</th>";
		json={};
		json['data']=colnames[i];
		columns.push(json);
	}
	table_inner=table_inner+"</tr></thead>";
	document.getElementById(div).innerHTML=table_inner;
	
	$(document).ready(function() {
    		$("#"+div).DataTable( {
    		"bLengthChange": false, //开关，是否显示每页显示多少条数据的下拉框
			"searching" : false,//开关,search 
            //"aLengthMenu": [10,20,30],//设置每页显示数据条数的下拉选项
            'iDisplayLength': 8, //每页初始显示5条记录
    		"deferRender": true,
    		"bProcessing": true, 
    		"paginationType": "full_numbers",
    		"serverSide": false, 
    		"order": [[ 1, 'desc' ]],
    		'ajax': path,
    		'columns':columns
    		
    		} );  
    		} );
	
}

function bac_umap_noleg1_height(data,div,title0,height){
	var data=data;
	var div=div;
	var width0=$("#width_id").width()*0.55;
	var myPlot = document.getElementById(div);
	var layout = {
	         height: height,
	         width: width0,
	         font: {size: 15},
	        showlegend: false,
	         //margin: {"t": 80, "b": 150, "l": 30, "r": 5},
			title:title0,
			legend: {
//     	   	    bgcolor: 'white',
//     	   	    borderwidth: 1,
//     	   	    bordercolor: 'black',
     	   	    //orientation: 'h',//h.v
     	   	   // xanchor: 'center',
     	   	    //x: 10,
     	   	    //y:-0.2,
    	   	    font: {
    	   	      size: 15,
    	   	    }
    	   	  },
	        		  xaxis: {
	        		    showticklabels : false
	        		  },
	        		  yaxis: {
	        		    showticklabels : false
	        		  
	        		  }
	    }
	    Plotly.newPlot(div, data, layout, {showSendToCloud: true});
		myPlot.on('plotly_click', function(data){
    var pts = '';
    var spot_name0 = '';
    for(var i=0; i < data.points.length; i++){
        pts = 'x = '+data.points[i].x +'\ny = '+ data.points[i].y +'\nname = '+ data.points[i].text+ '\n\n';
        spot_name0=data.points[i].text;
    }
 

	
});
}


