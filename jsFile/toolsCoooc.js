innerpath="0_files/innerpath";

genus_arr="All,Citrobacter,Schizosaccharomyces,Exobasidium,Entamoeba,Naegleria,Lentivirus,Trichomonas,Antarctobacter,Diaporthe,Besnoitia,Epicoccum,Ustilago,Acrodontium,Heteroplacidium,Chaetomium,Physarum,Salpingoeca,Purpureocillium,Aspergillus,Acidovorax,Cercospora,Lecidea,Phytophthora,Chilodonella,Bysmatrum,Trichophyton,Montagnula,Erysiphe,Fusarium,Gammaretrovirus,Spathularia,Sargassum,Codosiga,Difflugia,Cutibacterium,Yarrowia,Colpoda,Alphapapillomavirus,Blastocystis,Cyclotella,Malassezia,Fuligo,Aphanoascus,Margalefidinium,Chromera,Exophiala,Orthohepevirus,Bacillus,Pneumocystis,Alternaria,Theileria,Pyropia,Pyricularia,Thermothielavioides,Betacoronavirus,Helicobacter,Burkholderia,Rhodotorula,Simplexvirus,Carlavirus,Quinqueloculina,Aerococcus,Pichia,Anaerococcus,Yersinia,Babesia,Cytomegalovirus,Poterioochromonas,Lecanactis,Streptomyces,Astrosphaeriella,Lymphocryptovirus,Diachea,Meyerozyma,Saccharomyces,Bensingtonia,Trichoderma,Cryptosporidium,Mastadenovirus,Phialophora,Hypsizygus,Ectocarpus,Phaffomyces,Sugiyamaella,Klebsiella,Bipolaris,Usnea,Umbilicaria,Pythium,Drechmeria,Mycoplasma,Hymenelia,Stemonitis,Acanthamoeba,Cyanidioschyzon,Sclerotinia,Roussoellopsis,Streptococcus,Amphora,Octospora,Chitinimonas,Dictyocheirospora,Diderma,Staphylococcus,Aglaothamnion,Gracilaria,Vaucheria,Suillus,Clonostachys,Botrytis,Ampelomyces,Saccharina,Polarella,Emiliania,Capsaspora,Rhynchopus,Chaetosphaerella,Aureobasidium,Meira,Sporothrix,Paravannella,Nakazawaea,Epichloe,Stygiella,Hepatozoon,Brevundimonas,Acinetobacter,Moraxella,Neisseria,Kingella,Eikenella,Aggregatibacter,Haemophilus,Bacteroides,Fusobacterium,Finegoldia,Peptostreptococcus,Schaalia,Peptococcus,Candida,Plasmodium,Porphyromonas,Prevotella,Veillonella,Cladosporium,Peptoniphilus,Wildemania,Granulicatella,Treponema,Otidea,Taphrina,Bisgaardia,Lachnoanaerobaculum,Filifactor,Eimeria,Leptotrichia,Ilyobacter,Lepra,Nicoletella,Hemiselmis,Flamella,Paradinium,Syntrophobotulus,Ustilaginoidea,Scutaria,Richelia,Thermoanaerosceptrum,Campylobacter,Bergeriella,Actinobacillus,Glaesserella,Pasteurella,Parabacteroides,Capnocytophaga,Enterococcus,Alkalihalobacillus,Paraclostridium,Clostridioides,Lactobacillus,Kluyveromyces,Penicillium,Corynebacterium,Peptoanaerobacter,Guillardia,Sphaerozoum,Amanita,Mannheimia,Hamigera,Farysia,Alysiella,Adenoides,Sellaphora,Sticta,Gramella,Porphyra,Desulfotomaculum,Paraprevotella,Placidium,Verrucaria,Anomoloma,Pontoporeia,Desulfallas,Aureibacter,Morococcus,Tetragenococcus,Bibersteinia,Talaromyces,Lacrimispora,Vestergrenopsis,Flavobacterium,Marinicauda,Cordierites,Micrococcus,Kocuria,Paeniclostridium,Nakaseomyces,Orthohepadnavirus,Abiotrophia,Pyrsonympha,Mastigamoeba,Lirula,Terrahaemophilus,Pertusaria,Astraeus,Encyonema,Paramonosiga,Simonsiella,Chryseobacterium,Escherichia,Cardiobacterium,Millerozyma,Scheffersomyces,Wickerhamomyces,Saccharomycopsis,Debaryomyces,Cryptococcus,Metschnikowia,Eremothecium,Teunomyces,Rothia,Aureococcus,Hyphopichia,Lautropia,Barnettozyma,Basfia,Helicobasidium,Yamadazyma,Paenibacillus,Alicyclobacillus,Rhodocybella,Sporisorium,Basilea,Dyella,Goniomonas,Massilia,Pseudomonas,Psychrobacter,Nitrosospira,Pseudopedobacter,Cymbella,Byssochlamys,Monascus,Pseudoplectania,Ascothailandia,Paracoccus,Tricholoma,Leucoscypha,Thioclava,Methylorubrum,Catathelasma,Leucodecton,Isochrysis,Caloscypha,Bunodophoron,Erratomyces,Anoxybacillus,Physarella,Wardomyces,Salispina,Novispirillum,Methylobacterium,Aeromonas,Lysinibacillus,Schizophyllum,Trichosporon,Leishmania,Toxoplasma,Thermomonas,Neobacillus,Cloacibacterium,Ochrobactrum,Enterobacter,Sphingobacterium,Mycobacterium,Skeletonema,Leucosporidium,Euplotes,Flavivirus,Hanseniaspora,Achromobacter,Phaeocystis,Clavispora,Glaucocystis,Graphiola,Pyxidiophora,Devosia,Angomonas,Leucoagaricus,Haplospora,Sporosarcina,Comamonas,Cutaneotrichosporon,Craterium,Chlorociboria,Deinococcus,Brebissonia,Tremella,Neocampanella,Capronia,Jattaea,Neurospora,Aphanomyces,Morosphaeria,Botuliforma,Chroomonas,Stenamoeba,Dioszegia,Padina,Alcaligenes,Atlantibacter,Bacteriovorax,Clostridium,Cryptomonas,Vanrija,Novosphingobium,Phascolarctobacterium,Lodderomyces,Dietzia,Heteromita,Kluyvera,Ampulloclitocybe,Bullera,Phyllactinia,Desemzia,Rasamsonia,Peptacetobacter,Imshaugia,Pterothamnion,Caulobacter,Apiotrichum,Polaromonas,Delftia,Stenotrophomonas,Lotharella,Leucobacter,Mattirolomyces,Romboutsia,Aureimonas,Verticillium,Castellaniella,Velundella,Bhatiellae,Planococcus,Cyberlindnera,Kodamaea,Ochromonas,Empedobacter,Rhodobacter,Mycolicibacterium,Filobasidium,Lycoperdon,Trypanosoma,Telluria,Glutamicibacter,Afipia,Tryblidiopsis,Hygrocybe,Hungatella,Haematobacter,Peribacillus,Peltigera,Carboxydothermus,Parabodo,Shinella,Thioalkalivibrio,Cronobacter,Pinnularia,Gordonia,Cytobacillus,Collimonas,Eucyrtidium,Mayamaea,Hydrosilicon,Monacrosporium,Lysobacter,Parastagonospora,Plasmodiophora,Apinisia,Phacopsis,Brevibacillus,Leclercia,Sphingomonas,Sporopachydermia,Protomyces,Monosiga,Kytococcus,Fistulifera,Herbaspirillum,Tranzscheliella,Kurthia,Athelia,Lecidella,Giardia,Alphavirus,Nostoc,Anabaena,Placynthium,Chroogloeocystis,Brasilonema,Modestobacter,Catenulispora,Lachnellula,Navicula,Pleurasiga,Protolitonotus,Aliterella,Ostreopsis,Leuconostoc,Acetobacter,Anthracocystis,Brettanomyces,Blastomonas,Symbiotaphrina,Fistulina,Dipodascus,Sphingobium,Ramalina,Gonostomum,Hymenobacter,Blastomyces,Fonticula,Fimbriimonas,Leptographium,Avibacterium,Cylindrotheca,Chlorarachnion,Pterocladia,Thioploca,Subbaromyces,Ascovaginospora,Gymnochlora,Micropruina,Platismatia,Dibaeis,Rhodochaete,Galdieria,Sarcocystis,Serratia,Gracilariopsis,Cladonia,Septoria,Polerovirus,Cytophaga,Paraconiothyrium,Voromonas,Anteholosticha,Nocardioides,Durotheca,Pyrenula,Teloschistes,Thecamonas,Laccaria,Plagioselmis,Thermanaeromonas,Kazachstania,Phialemonium,Rhizomastix,Endocarpon,Phaeoacremonium,Defluviimonas,Ceraceosorus,Lentzea,Orrella,Agaricus,Erythrocolon,Halomonas,Coleosporium,Tribonema,Nannochloropsis,Nuclearia,Inocybe,Nitzschia,Hirschia,Baudoinia,Metarhizium,Protoperidinium,Philaster,Betapolyomavirus,Claussenomyces,Pleurotus,Dictyostelium,Prymnesium,Archangium,Cavenderia,Geosmithia,Oryzomicrobium,Serratifera,Acidipropionibacterium,Passalora,Heterostelium,Haplosporidium,Curdiea,Paraphysomonas,Glaucosphaera,Tuber,Cephaloascus,Boudiera,Lachnum,Grosmannia,Distigma,Delitschia,Xanthoparmelia,Paraburkholderia,Peziza,Beauveria,Ebolavirus,Carpediemonas,Monomorphina,Aulacoseira,Speerschneidera,Polykrikos,Bicosoeca,Elsinoe,Eucomonympha,Chaetoceros,Gambierdiscus,Spumochlamys,Badhamia,Astrochapsa,Diorchidium,Chelonemonas,Dermabacter,Iotanema,Geastrum,Selenidium,Saccharopolyspora,Pseudonocardia,Lentinula,Respirovirus,Naumovozyma,Fragilidium,Cordyceps,Lobospira,Bellemerea,Notosolenus,Fasciatispora,Eunotia,Melampsora,Erythrobacter,Pullenia,Sappinia,Entoloma,Scedosporium,Aspidisca,Gregarina,Plagiostoma,Francisella,Pleurotheciella,Bullinularia,Reticulamoeba,Stictocyclus,Labilithrix,Acytostelium,Paraphaeosphaeria,Paracamarosporium,Fusichalara,Montagnia,Ascotaiwania,Dicrateria,Betaretrovirus,Gromia,Volvariella,Paurocotylis,Clavariadelphus,Acarospora,Symbiomonas,Chaenotheca,Pseudoamphisiella,Pseudocercospora,Zasmidium,Hydeomyces,Zygoascus,Ophiostoma,Blattabacterium,Acaromyces,Olpidiopsis,Bradyrhizobium,Brachyspira,Cladophialophora,Edwardsiella,Immersiporthe,Sulfuracidifex,Ralstonia,Acidiphilium,Rhodymenia,Kwoniella,Sphaerobolus,Amphidinium,Saccamoeba,Tetramitus,Leptogium,Lophocladia,Plasmopara,Borreliella,Phaeophyscia,Osmundaria,Centropyxis,Trematosphaeria,Histoplasma,Morchella,Ascoidea,Melanopsichium,Lentomitella,Cyanidium,Ascosphaera,Alpharetrovirus,Riemerella,Epidermophyton,Orbivirus,Warcupiella,Vacuolaria,Globigerinella,Monilinia,Cryptobia,Moesziomyces,Trapelia,Holomastigotoides,Physconia,Danielozyma,Astasia,Myriangium,Caliciopsis,Bigelowiella,Macroventuria,Daldinia,Aurigamonas,Strombidium,Periconia,Parmeliella,Urocystis,Articulospora,Paecilomyces,Gaeumannomyces,Protostelium,Normandina,Maullinia,Ogataea,Conoideocrella,Paraglaciecola,Kalmanozyma,Pochonia,Chondria,Myriospora,Paramoebidium,Allodekkera,Mycena,Favella,Dothidotthia,Costaria,Leptoxyphium,Calicium,Epistylis,Trichodinella,Lampriscus,Rhodopseudomonas,Surirella,Pygsuia,Pectenia,Microchloropsis,Rhaphoneis,Evernia,Carinispora,Dinema,Flammeascoma,Paraphelidium,Rhinocladiella,Amoeba,Parvimonas,Apophlaea,Rhizopogon,Korotnevella,Hypholoma,Entodinium,Bifidobacterium,Lachnospira,Biatora,Symbiodinium,Prorocentrum,Chromocleista,Vannella,Neospora,Ammonia,Rhizorhabdus,Paulinella,Squamarina,Halteria,Heterococcus,Capnodium,Rutstroemia,Blautia,Dialister,Filimonas,Fluviicola,Sphaerospermopsis,Stylonema,Cohnilembus,Selenomonas,Bangia,Togula,Magnusiomyces,Enterocloster,Pectinatus,Listeria,Propionigenium,Tyzzerella,Sneathia,Schwartzia,Nyctotherus,Serpula,Pseudobutyrivibrio,Catonella,Olsenella,Centipeda,Muribaculum,Microvirga,Peridinium,Tuckermannopsis,Telaepolella,Paramoeba,Blastobotrys,Peronospora,Phaeophleospora,Suillellus,Devriesia,Cercomonas,Scolecolachnum,Wickerhamiella,Diploschistes,Hatena,Acidothermus,Toxicocladosporium,Amoebidium,Kurtzmaniella,Kockovaella,Albotricha,Triplumaria,Gymnosporangium,Balantidium,Phragmotaenium,Marquandomyces,Gonyaulax,Entyloma,Macrotyphula,Discosporangium,Gomphillus,Hypomontagnella,Lawreyella,Loxodes,Protoopalina,Hyalophysa,Orthopneumovirus,Coccocarpia,Geobacillus,Vermamoeba,Microsporum,Arthrobacter,Armillaria,Gymnoascus,Trichocoma,Gymnascella,Xeromyces,Silvetia,Dactylina,Trichia,Orbilia,Phymatotrichopsis,Nakamurella,Macrococcus,Didymella,Hypogymnia,Lecanographa,Dingleya,Nannizziopsis,Leiothecium,Steinera,Solirubrobacter,Xerochrysium,Protounguicularia,Elizabethkingia,Lactococcus,Eremascus,Thermomyces,Bresslaua,Microbacterium,Homalozoon,Renispora,Sarcoscypha,Sagenomella,Pyrenophora,Lecanora,Neophyllis,Shanorella,Mycocalicium,Trimastix,Knufia,Pirsonia,Platygloea,Rhizosolenia,Ophiocordyceps,Conchellium,Hydnomerulius,Teratosphaeria,Staurothele,Lepraria,Lambertella,Placopyrenium,Reddellomyces,Tardiphaga,Massaria,Bryoria,Neocatenulostroma,Emmonsiellopsis,Bacidia,Lophodermium,Goussia,Photobacterium,Saprolegnia,Trigonium,Verminephrobacter,Ochroconis,Grimontia,Gomphus,Picophagus,Loxosporopsis,Metopion,Exserohilum,Oxyrrhis,Monoicomyces,Corynelia";

celltype_full_name_use="";
$.ajaxSettings.async = false;
$.getJSON(innerpath+"/celltype_full_name_use.txt", "", function(data_re) {
	celltype_full_name_use=data_re;
});


genus_arr_xml("xml_bac_detail",genus_arr);

toolsDetailShow('GSE179572_GSM5420750','KCNK17','Theileria');


function toolsDetailShow(datasetID,gene,bac_select){
	$("#loading1").show();
	dataSetID=datasetID
webpath="0_files/slice/"+dataSetID;
bac_table_dir=webpath+"/bac_table";
bac_json=webpath+"/json";

bac_re="";
$.ajaxSettings.async = false;
$.getJSON(webpath+"/bac_infor.txt", "", function(data_re) {
	bac_re=data_re;
});

bac_gene_module_re="";
$.ajaxSettings.async = false;
$.getJSON(webpath+"/part7_bac_gene_module_infor.txt", "", function(data_re) {
	bac_gene_module_re=data_re;
});

part7_bac_gene_coooc(bac_re,bac_gene_module_re,webpath,bac_table_dir,bac_json,gene,bac_select);

document.getElementById("h_b_cooc").innerHTML="Host bacterial co expression module of "+dataSetID;

$("#loading1").hide();
}


function part7_bac_gene_coooc(bac_re,bac_gene_module_re,webpath,bac_table_dir,bac_json,gene,bac_select){
	//bac_gene_module_re.hasOwnProperty("p7")
	if(bac_gene_module_re["p7"]=="no"){
		document.getElementById("p7_c").style.display="none";
		document.getElementById("p7_left").style.display="none";
		
	}else{
		if(bac_select=="All"){
			g0=bac_gene_module_re["bac_enrich"].split(",")[0];
		}else{
			g0="genus_"+bac_select;
		}
		if ($.fn.dataTable.isDataTable('#st_bac_gene_coocc_table')) {
			$('#st_bac_gene_coocc_table').DataTable().clear().destroy();
		}
		dataTable_bac_gene_coooc_p7(bac_table_dir+"/bac_gene_cooc.txt","st_bac_gene_coocc_table");
		if(bac_select=="All"){
					//让选择的gene靠前
										$(document).ready(function() {
											var table = $('#st_bac_gene_coocc_table').DataTable();

											// 获取所有行的数据
											var data = table.rows().data();

											// 分离符合条件的行和不符合条件的行
											var matchedRows = [];
											var unmatchedRows = [];
											data.each(function(value, index) {
												if (value[0] === g0 && value[1] === gene) {
													matchedRows.push(value); // 第一列为"a"且第二列为"b"
												} else {
													unmatchedRows.push(value);
												}
											});

											// 合并数组，使符合条件的行在前
											var sortedData = matchedRows.concat(unmatchedRows);

											// 清空表格
											table.clear();

											// 用排序后的数据重新填充表格
											table.rows.add(sortedData).draw();
										});
				}else{
			//删除非g0的行
					$(document).ready(function() {
						var table = $('#st_bac_gene_coocc_table').DataTable();

						// 遍历所有行，删除不包含字符串"a"的行
						table.rows().every(function() {
							var data = this.data();
							if (!data[0].includes(g0)) { // 假设包含字符串"a"的是第一列
								this.remove(); // 删除不包含字符串"a"的行
							}
						}).draw(); // 重新绘制表格
					});
			//让选择的gene靠前
					$(document).ready(function() {
											var table = $('#st_bac_gene_coocc_table').DataTable();

											// 获取所有行的数据
											var data = table.rows().data();

											// 分离符合条件的行和不符合条件的行
											var matchedRows = [];
											var unmatchedRows = [];
											data.each(function(value, index) {
												if (value[0] === g0 && value[1] === gene) {
													matchedRows.push(value); // 第一列为"a"且第二列为"b"
												} else {
													unmatchedRows.push(value);
												}
											});

											// 合并数组，使符合条件的行在前
											var sortedData = matchedRows.concat(unmatchedRows);

											// 清空表格
											table.clear();

											// 用排序后的数据重新填充表格
											table.rows.add(sortedData).draw();
										});

				}
		//echars_circos_cellcell_p7(bac_json+"/"+g0+'_p7_circos.json','river_bac_gene_coocc',0.98);
		echars_circos_cellcell_p7(bac_json+'/'+g0+"_p7_circos.json",'river_bac_gene_coocc',0.98);
			if(bac_gene_module_re.hasOwnProperty("p7_go")){
				document.getElementById("p7_go").style.display="none";
			}else{
				//
				if ($.fn.dataTable.isDataTable('#st_bac_gene_enrich_table')) {
					$('#st_bac_gene_enrich_table').DataTable().clear().destroy();
				}
				bacEnrichTable(bac_table_dir+'/'+g0+'_enrich_table_p7.txt','st_bac_gene_enrich_table');
				
				//
				var x0=bac_gene_module_re[g0+"_enrich_fdr"].split(",").reverse();
				var y0=bac_gene_module_re[g0+"_pathways"].split(",").reverse();
				bac_encrich_bar_h(x0,y0,g0,'enrich_bac_gene');
			}
		}
}


function bac_encrich_bar_h(x,y,title,div){
var trace1 = {
  x: x,
  y: y,
  name: 'Enrich',
  orientation: 'h',
  marker: {
    color: 'red',
    width: 3
  },
  type: 'bar'
};
var data = [trace1];

var layout = {
  title: title,
  font :{size :14,},
  margin: {"t": 80, "b": 150, "l": 400, "r": 20}, //图边缘距离画布上下左右边界的距离，单位px
  xaxis: {
				//range: [ 0.75, 5.25 ],
				title: "-Log10 P value" ,
				//showticklabels : false,
				//zeroline: true
			  },
  barmode: 'stack'
	};
	Plotly.newPlot(div, data, layout);
}

function  dataTable_bac_gene_coooc_p7(path,div){
	$(document).ready(function() {
    		$("#"+div).DataTable( {
    		"bLengthChange": false, //开关，是否显示每页显示多少条数据的下拉框
			"searching" : false,//开关,search 
            //"aLengthMenu": [10,20,30],//设置每页显示数据条数的下拉选项
            'iDisplayLength': 8, //每页初始显示5条记录
    		"deferRender": true,
    		"bProcessing": true, 
    		"paginationType": "full_numbers",
    		"serverSide": false, 
    		"order": [[ 2, 'desc' ]],
    		'ajax': path,
    		'columns':[
		{'data':'bac'},
		{'data':'gene'},
		{'data':'corr'},
		{'data':'p'},
		{'data':'fdr'},
		{'data':null,
		"render": function ( data, type, row, meta ) {  
		return  "<i class='fa fa-line-chart' aria-hidden='true' style='font-size:20px;cursor: pointer;color:#ff9a18'  onclick= "+'"'+"spatial_gene_coooc_onclick_p7("+"'"+row['bac']+"'"+')"'+" ></i> ";
								                    }//data是对应当前cell的值，row是对应当前行中的所有cell的值
		}
		]
    		
    		} );
    		} );
	
}


function echars_circos_cellcell_p7(filepath,div,width0){
	
	$("#"+div).css("height",'600px');
	var width0=$("#width_id").width()*width0;
	$("#"+div).css("width",width0);
	var filepath=filepath;
	var colors_all=["#CC3333","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0","#F6F7D0"];
	//console.log(width);
	var chartDom_circos = document.getElementById(div);
	var myChart_circos = echarts.init(chartDom_circos);
	//var myChart_circos =echarts.init(document.getElementById('cellInteraction_circos_italk'), null, {renderer: 'svg'});
	
	var option_circos;
	myChart_circos.showLoading();
	$.get(filepath, function (graph) {
		myChart_circos.hideLoading();

	    graph.nodes.forEach(function (node) {
	        node.label = {
	            show: node.symbolSize > 1
	        };
	    });
	    option_circos = {
	    		toolbox: {
			          show: true,
			          left:"right",
			          feature: {
			        	  
			              mark: {show: true},
			              //dataView: {show: true, readOnly: false},
			              //restore: {show: true},
			              saveAsImage: {show: true,
			            	  name:"circos", 
			            	  title:"Save"}
			          }
			      },
//	        title: {
//	            text: 'The visualization of host bacterial Co-expression module',
//	            //subtext: 'Default layout',
//	            top: 'top',
//	            left: 'center'
//	        },
	        tooltip: {},
//	        legend: [{
//	        	top:"90%",
//	            // selectedMode: 'single',
//	            data: graph.categories.map(function (a) {
//	                return a.name;
//	            })
//	        }],
	        animationDuration: 1500,
	        animationEasingUpdate: 'quinticInOut',
	        color: colors_all,
	        series: [
	            {
	                name: 'Regulation network',
	                type: 'graph',
	                layout: 'circular',
	                data: graph.nodes,
	                links: graph.links,
	                categories: graph.categories,
	                roam: true,
	                label: {
	                    position: 'right',
	                    formatter: '{b}'
	                },
	                lineStyle: {
	                    color: 'source',
	                    curveness: 0.3
	                },
	                
	                emphasis: {
	                    focus: 'adjacency',
	                    lineStyle: {
	                        width: 10
	                    }
	                }
	            }
	        ]
	    };

	    myChart_circos.setOption(option_circos);
	});

	option_circos && myChart_circos.setOption(option_circos);

}
function toolsCoooC(){
	$("#loading1").show();
	var bac= xmSelect.get('#xml_bac_detail', true).getValue('valueStr');
	var gene=document.getElementById("gene").value;
	gene=$.trim(gene);
	if(gene.length==0){
		alert("INPUT A GENE FIRST !");
		return false;
	}
	
	var xmlHttp=new XMLHttpRequest();
	xmlHttp.onreadystatechange =function(){
		//处理返回的数据，更新当前页面
		if(xmlHttp.readyState == 4 && xmlHttp.status == 200){
			var returnData=xmlHttp.responseText;
		//alert(returnData);
			//eval 执行括号中的代码或者JSON.parse，把json格式转化为json对象
			var jsonobj=JSON.parse(returnData);
			if(jsonobj.error_attention=="no"){
				////
				
				document.getElementById("ToolsSearchTable").style.display="block";
				//var oldTable = $('#tools_sub_table').dataTable();
				//oldTable.fnClearTable(); //清空一下table
				//oldTable.fnDestroy(); //还原初始化了的dataTable
				
				if ($.fn.dataTable.isDataTable('#tools_sub_table')) {
					$('#tools_sub_table').DataTable().clear().destroy();
				}
				ToolsSubTable_coooc("0_files/ToolsBacCoooC.txt",gene,bac);
			}else{
				////
				document.getElementById("ToolsSearchTable").style.display="block";
				document.getElementById("ToolsSearchTable").innerHTML="No result";
			}
			$("#loading1").hide();
				}
			}
	var param="gene="+gene+"&bac="+bac+"&toolsType=bacCoooC";
	
	xmlHttp.open("get","MysqlTools.jsp?"+param,true);
	xmlHttp.send();
	
}



function ToolsSubTable_coooc(path,gene,bac){
	var path=path;
	$(document).ready(function() {
		$("#tools_sub_table").DataTable( {
		"bLengthChange": false, //开关，是否显示每页显示多少条数据的下拉框
        "aLengthMenu": [5,10,20],//设置每页显示数据条数的下拉选项
        'iDisplayLength': 5, //每页初始显示5条记录
		"deferRender": true,
		"bProcessing": true, 
		"searching" : false,
		"paginationType": "full_numbers",
		"serverSide": false, 
		"order": [[ 0, 'desc' ]],
		'ajax': path,
		'columns':[
		{'data':'cancer'},
		{'data':null,"render": function ( data, type, row, meta ) { return bac;}},
		{'data':null,"render": function ( data, type, row, meta ) { return gene;}},
		//{'data':'spot_num'},
		{'data':'marker_gene_num'},
		//{'data':'marker_gene_num'},
		//{'data':'cell_num'},
		{'data':'celltype_num'},
		{'data':null,
    		"render": function ( data, type, row, meta ) {  
			var publication=row['publication'];
			if(publication.length > 5){
				publication="<span title='" + publication + "'>" + publication.substr(0, 4) + '&#8230;</span>';
			}
    		return  "<a   target='_blank' href='"+row['paper_http']+"'> <i class='fa-solid fa-link' style='font-size:16px;color:#ff9a18' aria-hidden='true'   ></i> "+publication+"</a> ";
    		}
    		},
		{'data':null,
		"render": function ( data, type, row, meta ) {  
		//console.log("<button class='btn btn-danger botton-submit' onclick="+'"'+"toolsDetailShow('"+row['dataset_id']+"')"+'"'+">" +"<i class='fa fa-share' aria-hidden='true' style='font-size:15px;'></i></button>");
		return "<button class='btn btn-danger botton-submit' style='height:35px;' onclick="+'"'+"toolsDetailShow('"+row['dataset_id']+"','"+gene+"','"+bac+"'"+")"+'"'+">" +"<i class='fa fa-share' aria-hidden='true' style='font-size:15px;'></i></button>";  
						                    }
		}
		]
		} );  
		} );
}




function genus_arr_xml(div,genus_arr){
	var data_option=genus_arr.split(",");
	var data_option_valuearray = [];
	for (var i=0;i<data_option.length;i++)
					{ 
						json={}
						json['name']=data_option[i];
						json['value']=data_option[i];
						data_option_valuearray.push(json);
					}
	var e="#"+div;
					var demo1_gene = xmSelect.render({
						el: e, 
						filterable: true,
						size: 'big',//选中的之后显示的字的大小
					    theme: {color: '#ff9a18',},//主题颜色
						tips: 'Select a key for view',
						style: {
		marginLeft: '0px',
		borderRadius: '1px',
		height: '48px',
		//width:'400px',
		border: '1px solid #ced4da',
	},
						radio: true,
						clickClose: true,
						filterable: true,
						data: [],
						on: function(data){//监听
							var arr = data.arr;
							var change = data.change;
							//isAdd, 此次操作是新增还是删除
							var isAdd = data.isAdd;
							var gene0=arr[0]["value"];
							///
							//gene_spatial_exp(gene0,div_color);
							
							}
					})
					demo1_gene.update({
					data: data_option_valuearray
					})
	// 赋值
			demo1_gene.setValue([
			{name: data_option[0], value: data_option[0]},
			])
}

function toolsCooCexample(gene){
	var bac="All";
	var gene=gene;
	
	
	var xmlHttp=new XMLHttpRequest();
	xmlHttp.onreadystatechange =function(){
		//处理返回的数据，更新当前页面
		if(xmlHttp.readyState == 4 && xmlHttp.status == 200){
			var returnData=xmlHttp.responseText;
		//alert(returnData);
			//eval 执行括号中的代码或者JSON.parse，把json格式转化为json对象
			var jsonobj=JSON.parse(returnData);
			if(jsonobj.error_attention=="no"){
				////
				
				document.getElementById("ToolsSearchTable").style.display="block";
				
				if ($.fn.dataTable.isDataTable('#tools_sub_table')) {
					$('#tools_sub_table').DataTable().clear().destroy();
				}
				ToolsSubTable_coooc("0_files/ToolsBacCoooC.txt",gene,bac);
			}else{
				////
				document.getElementById("ToolsSearchTable").style.display="block";
				document.getElementById("ToolsSearchTable").innerHTML="No result";
			}
			$("#loading1").hide();
				}
			}
	var param="gene="+gene+"&bac="+bac+"&toolsType=bacCoooC";
	
	xmlHttp.open("get","MysqlTools.jsp?"+param,true);
	xmlHttp.send();
	
}

function spatial_gene_coooc_onclick_p7(bac){
	echars_circos_cellcell_p7(bac_json+"/"+bac+'_p7_circos.json','river_bac_gene_coocc',0.98);
	
	bacs=bac_gene_module_re["bac_enrich"].split(",");
	if(bacs.indexOf(bac)!=-1){
		document.getElementById("p7_go").style.display="block";
	if(bac_gene_module_re.hasOwnProperty("p7_go")){
				document.getElementById("p7_go").style.display="none";
			}else{
				if ($.fn.dataTable.isDataTable('#st_bac_gene_enrich_table')) {
				$('#st_bac_gene_enrich_table').DataTable().clear().destroy();
				}
				bacEnrichTable(bac_table_dir+'/'+bac+'_enrich_table_p7.txt','st_bac_gene_enrich_table');
				
				//
				var x0=bac_gene_module_re[bac+"_enrich_fdr"].split(",");
				var y0=bac_gene_module_re[bac+"_pathways"].split(",");
				bac_encrich_bar_h(x0,y0,bac,'enrich_bac_gene');
	}
	
}else{
	document.getElementById("p7_go").style.display="none";
}
}


function bacEnrichTable(path,div){
	var path=path;
	var div='#'+div;
	$(document).ready(function() {												
		$(div).DataTable( {
		"bLengthChange": false, //开关，是否显示每页显示多少条数据的下拉框
		"searching":false,
		"deferRender": true,//big data
		"bProcessing": true, //显示是否加载 
		"paginationType": "full_numbers",//详细分页组，可以支持直接跳转到某页 
		"serverSide": false,      //后台处理分页则为true  
		'ajax': path,
		'columns':[
		{'data':'bac'},
		{'data':'Pathway',render: $.fn.dataTable_enrich(10)},
		{'data':'P_value'},
		{'data':'FDR_value'},
		{'data':'intermarker',
			render: $.fn.enrich(3)}
		]
		} );
		} );

	//返回部分值，按照逗号分隔的并且
	$.fn.enrich = function (cutoff) {
			return function (data, type, row) {
			if (type === 'display') {
				var str = data.toString(); // cast numbers
				var strArr=str.split(",")
				return strArr.length < cutoff ?
					strArr :
						"<span  title='" + str + "'>" + strArr.slice(0,3).join() + '&#8230;</span>';
						}
						return data;
						};
						};
	//超过长度的鼠标放上显示全部
		$.fn.dataTable_enrich = function (cutoff) {
			return function (data, type, row) {
				if (type === 'display') {
					var str = data.toString(); // cast numbers
		
					return str.length < cutoff ?
						str :
						"<span title='" + str + "'>" + str.substr(0, cutoff - 1) + '&#8230;</span>';
				}
		
				// Search, order and type can use the original data
				return data;
			};
		};
}
